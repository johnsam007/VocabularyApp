<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:System="clr-namespace:System;assembly=mscorlib"
             xmlns:viewmodels="clr-namespace:AgeSmartVocabulary.ViewModels"
             x:Class="AgeSmartVocabulary.Views.HomePage"
             x:DataType="viewmodels:HomeViewModel"
             BackgroundColor="#F8F9FA">

    <!-- Gradient Background -->
    <ContentPage.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#667EEA" Offset="0.0" />
            <GradientStop Color="#764BA2" Offset="1.0" />
        </LinearGradientBrush>
    </ContentPage.Background>

    <Grid RowDefinitions="Auto,*,Auto" Padding="20">

        <!-- Header -->
        <VerticalStackLayout Grid.Row="0" Spacing="5" Margin="0,20,0,30">
            <Label Text="ðŸ“š Word of the Day"
                   FontSize="28"
                   FontAttributes="Bold"
                   TextColor="White"
                   HorizontalTextAlignment="Center" />
            <Label Text="{Binding Source={x:Static System:DateTime.Today}, StringFormat='{0:dddd, MMMM dd}'}"
                   FontSize="14"
                   TextColor="#E0E0E0"
                   HorizontalTextAlignment="Center" />
        </VerticalStackLayout>

        <!-- Loading State -->
        <VerticalStackLayout Grid.Row="1"
                             IsVisible="{Binding IsLoading}"
                             VerticalOptions="Center"
                             Spacing="20">
            <ActivityIndicator IsRunning="{Binding IsLoading}"
                              Color="White"
                              HeightRequest="60"
                              WidthRequest="60" />
            <Label Text="Finding perfect word for you..."
                   FontSize="16"
                   TextColor="White"
                   HorizontalTextAlignment="Center" />
        </VerticalStackLayout>

        <!-- No Word State -->
        <VerticalStackLayout Grid.Row="1"
                             IsVisible="{Binding CurrentWord, Converter={StaticResource IsNullConverter}}"
                             VerticalOptions="Center"
                             Spacing="20"
                             Padding="30">
            <Label Text="ðŸ˜•"
                   FontSize="80"
                   HorizontalTextAlignment="Center" />
            <Label Text="Oops! Couldn't fetch a word"
                   FontSize="22"
                   FontAttributes="Bold"
                   TextColor="White"
                   HorizontalTextAlignment="Center" />
            <Label Text="Check your internet connection"
                   FontSize="16"
                   TextColor="#E0E0E0"
                   HorizontalTextAlignment="Center" />
            <Button Text="ðŸ”„ Try Again"
                    Command="{Binding LoadTodayWordCommand}"
                    BackgroundColor="White"
                    TextColor="#667EEA"
                    FontSize="18"
                    FontAttributes="Bold"
                    CornerRadius="25"
                    HeightRequest="50"
                    WidthRequest="200"
                    Margin="0,20,0,0"
                    HorizontalOptions="Center" />

            <!-- Test Button (Remove after fixing) -->
            <Button Grid.Row="2"
        Text="ðŸ§ª Test Connection"
        Command="{Binding TestConnectionCommand}"
        BackgroundColor="#9B59B6"
        TextColor="White"
        FontSize="16"
        CornerRadius="15"
        HeightRequest="50"
        Margin="0,80,0,0"
        VerticalOptions="End" />

        </VerticalStackLayout>

        <!-- Word Card with Swipe -->
        <Frame Grid.Row="1"
               IsVisible="{Binding CurrentWord, Converter={StaticResource IsNotNullConverter}}"
               BackgroundColor="White"
               CornerRadius="30"
               HasShadow="True"
               Padding="0"
               Margin="10"
               VerticalOptions="Center">

            <Grid RowDefinitions="*,Auto">

                <!-- Card Content -->
                <ScrollView Grid.Row="0">
                    <VerticalStackLayout Padding="40" Spacing="25">

                        <!-- Word -->
                        <Label Text="{Binding CurrentWord.Word}"
                               FontSize="48"
                               FontAttributes="Bold"
                               TextColor="#2C3E50"
                               HorizontalTextAlignment="Center"
                               LineBreakMode="WordWrap" />

                        <!-- Phonetic -->
                        <Label Text="{Binding CurrentWord.Phonetic}"
                               FontSize="18"
                               TextColor="#7F8C8D"
                               FontAttributes="Italic"
                               HorizontalTextAlignment="Center"
                               IsVisible="{Binding CurrentWord.Phonetic, Converter={StaticResource StringNotEmptyConverter}}"
                               Margin="0,-10,0,0" />

                        <!-- Part of Speech Badge -->
                        <Frame BackgroundColor="#E8EAF6"
                               Padding="15,8"
                               CornerRadius="20"
                               HasShadow="False"
                               HorizontalOptions="Center"
                               IsVisible="{Binding CurrentWord.PartOfSpeech, Converter={StaticResource StringNotEmptyConverter}}">
                            <Label Text="{Binding CurrentWord.PartOfSpeech}"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="#5E35B1"
                                   HorizontalTextAlignment="Center" />
                        </Frame>

                        <!-- Divider -->
                        <BoxView HeightRequest="2"
                                BackgroundColor="#ECF0F1"
                                CornerRadius="1"
                                Margin="0,10" />

                        <!-- Meaning Label -->
                        <Label Text="âœ¨ Meaning"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="#5E35B1" />

                        <!-- Meaning -->
                        <Label Text="{Binding CurrentWord.Meaning}"
                               FontSize="18"
                               TextColor="#2C3E50"
                               LineBreakMode="WordWrap"
                               Margin="0,-10,0,0" />

                        <!-- Example (if available) -->
                        <Frame BackgroundColor="#F0F4F8"
                               Padding="20"
                               CornerRadius="15"
                               HasShadow="False"
                               IsVisible="{Binding CurrentWord.Example, Converter={StaticResource StringNotEmptyConverter}}"
                               Margin="0,10,0,0">
                            <VerticalStackLayout Spacing="10">
                                <Label Text="ðŸ’¡ Example"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="#667EEA" />
                                <Label Text="{Binding CurrentWord.Example}"
                                       FontSize="16"
                                       TextColor="#34495E"
                                       FontAttributes="Italic"
                                       LineBreakMode="WordWrap" />
                            </VerticalStackLayout>
                        </Frame>

                    </VerticalStackLayout>
                </ScrollView>

                <!-- Swipe Indicators -->
                <Grid Grid.Row="1"
                      Padding="30,20"
                      ColumnDefinitions="*,*"
                      ColumnSpacing="15">

                    <!-- Revise Hint (Left) -->
                    <Frame Grid.Column="0"
                           BackgroundColor="#FFF3E0"
                           Padding="15,10"
                           CornerRadius="15"
                           HasShadow="False">
                        <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                            <Label Text="ðŸ‘ˆ"
                                   FontSize="20"
                                   VerticalOptions="Center" />
                            <Label Text="Revise"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="#F57C00"
                                   VerticalOptions="Center" />
                        </HorizontalStackLayout>
                    </Frame>

                    <!-- Know It Hint (Right) -->
                    <Frame Grid.Column="1"
                           BackgroundColor="#E8F5E9"
                           Padding="15,10"
                           CornerRadius="15"
                           HasShadow="False">
                        <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                            <Label Text="I Know"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="#2E7D32"
                                   VerticalOptions="Center" />
                            <Label Text="ðŸ‘‰"
                                   FontSize="20"
                                   VerticalOptions="Center" />
                        </HorizontalStackLayout>
                    </Frame>

                </Grid>

            </Grid>

            <!-- Add Swipe Gesture Recognizer -->
            <Frame.GestureRecognizers>
                <SwipeGestureRecognizer Direction="Right" 
                                       Command="{Binding MarkAsKnownCommand}"
                                       Threshold="100" />
                <SwipeGestureRecognizer Direction="Left" 
                                       Command="{Binding MarkAsReviseCommand}"
                                       Threshold="100" />
            </Frame.GestureRecognizers>

        </Frame>

        <!-- Bottom Action Buttons (Backup for non-swipe users) -->
        <Grid Grid.Row="2"
              IsVisible="{Binding CurrentWord, Converter={StaticResource IsNotNullConverter}}"
              ColumnDefinitions="*,Auto,*"
              ColumnSpacing="15"
              Margin="0,20,0,10">

            <!-- Revise Button -->
            <Button Grid.Column="0"
                    Text="â†º"
                    Command="{Binding MarkAsReviseCommand}"
                    BackgroundColor="#FF9800"
                    TextColor="White"
                    FontSize="32"
                    CornerRadius="30"
                    HeightRequest="60"
                    WidthRequest="60"
                    HorizontalOptions="End" />

            <!-- New Word Button -->
            <Button Grid.Column="1"
                    Text="âŸ³"
                    Command="{Binding LoadTodayWordCommand}"
                    BackgroundColor="White"
                    TextColor="#667EEA"
                    FontSize="28"
                    CornerRadius="25"
                    HeightRequest="50"
                    WidthRequest="50"
                    BorderColor="#667EEA"
                    BorderWidth="2" />

            <!-- Know It Button -->
            <Button Grid.Column="2"
                    Text="âœ“"
                    Command="{Binding MarkAsKnownCommand}"
                    BackgroundColor="#4CAF50"
                    TextColor="White"
                    FontSize="32"
                    CornerRadius="30"
                    HeightRequest="60"
                    WidthRequest="60"
                    HorizontalOptions="Start" />

        </Grid>

    </Grid>
</ContentPage>